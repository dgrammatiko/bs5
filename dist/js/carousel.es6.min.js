import t from"./dom/data.js";import e from"./dom/event-handler.js";import i from"./dom/manipulator.js";import s from"./dom/selector-engine.js";const n=t=>{t.dispatchEvent(new Event("transitionend"))};document.documentElement.dir;const o="carousel",a="bs.carousel",r={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},l={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},c={TOUCH:"touch",PEN:"pen"};class h extends class{constructor(e){e&&(this._element=e,t.setData(e,this.constructor.DATA_KEY,this))}dispose(){t.removeData(this._element,this.constructor.DATA_KEY),this._element=null}static getInstance(e){return t.getData(e,this.DATA_KEY)}static get VERSION(){return"5.0.0-beta1"}}{constructor(t,e){super(t),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(e),this._indicatorsElement=s.findOne(".carousel-indicators",this._element),this._touchSupported="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0,this._pointerEvent=Boolean(window.PointerEvent),this._addEventListeners()}static get Default(){return r}static get DATA_KEY(){return a}next(){this._isSliding||this._slide("next")}nextWhenVisible(){!document.hidden&&(t=>{if(!t)return!1;if(t.style&&t.parentNode&&t.parentNode.style){const e=getComputedStyle(t),i=getComputedStyle(t.parentNode);return"none"!==e.display&&"none"!==i.display&&"hidden"!==e.visibility}return!1})(this._element)&&this.next()}prev(){this._isSliding||this._slide("prev")}pause(t){t||(this._isPaused=!0),s.findOne(".carousel-item-next, .carousel-item-prev",this._element)&&(n(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}cycle(t){t||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config&&this._config.interval&&!this._isPaused&&(this._updateInterval(),this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}to(t){this._activeElement=s.findOne(".active.carousel-item",this._element);const i=this._getItemIndex(this._activeElement);if(t>this._items.length-1||t<0)return;if(this._isSliding)return void e.one(this._element,"slid.bs.carousel",()=>this.to(t));if(i===t)return this.pause(),void this.cycle();const n=t>i?"next":"prev";this._slide(n,this._items[t])}dispose(){super.dispose(),e.off(this._element,".bs.carousel"),this._items=null,this._config=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null}_getConfig(t){return t={...r,...t},((t,e,i)=>{Object.keys(i).forEach(s=>{const n=i[s],o=e[s],a=o&&((r=o)[0]||r).nodeType?"element":(t=>null==t?""+t:{}.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase())(o);var r;if(!new RegExp(n).test(a))throw new Error(t.toUpperCase()+": "+`Option "${s}" provided type "${a}" `+`but expected type "${n}".`)})})(o,t,l),t}_handleSwipe(){const t=Math.abs(this.touchDeltaX);if(t<=40)return;const e=t/this.touchDeltaX;this.touchDeltaX=0,e>0&&this.prev(),e<0&&this.next()}_addEventListeners(){this._config.keyboard&&e.on(this._element,"keydown.bs.carousel",t=>this._keydown(t)),"hover"===this._config.pause&&(e.on(this._element,"mouseenter.bs.carousel",t=>this.pause(t)),e.on(this._element,"mouseleave.bs.carousel",t=>this.cycle(t))),this._config.touch&&this._touchSupported&&this._addTouchEventListeners()}_addTouchEventListeners(){const t=t=>{this._pointerEvent&&c[t.pointerType.toUpperCase()]?this.touchStartX=t.clientX:this._pointerEvent||(this.touchStartX=t.touches[0].clientX)},i=t=>{t.touches&&t.touches.length>1?this.touchDeltaX=0:this.touchDeltaX=t.touches[0].clientX-this.touchStartX},n=t=>{this._pointerEvent&&c[t.pointerType.toUpperCase()]&&(this.touchDeltaX=t.clientX-this.touchStartX),this._handleSwipe(),"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(t=>this.cycle(t),500+this._config.interval))};s.find(".carousel-item img",this._element).forEach(t=>{e.on(t,"dragstart.bs.carousel",t=>t.preventDefault())}),this._pointerEvent?(e.on(this._element,"pointerdown.bs.carousel",e=>t(e)),e.on(this._element,"pointerup.bs.carousel",t=>n(t)),this._element.classList.add("pointer-event")):(e.on(this._element,"touchstart.bs.carousel",e=>t(e)),e.on(this._element,"touchmove.bs.carousel",t=>i(t)),e.on(this._element,"touchend.bs.carousel",t=>n(t)))}_keydown(t){if(!/input|textarea/i.test(t.target.tagName))switch(t.key){case"ArrowLeft":t.preventDefault(),this.prev();break;case"ArrowRight":t.preventDefault(),this.next()}}_getItemIndex(t){return this._items=t&&t.parentNode?s.find(".carousel-item",t.parentNode):[],this._items.indexOf(t)}_getItemByDirection(t,e){const i="next"===t,s="prev"===t,n=this._getItemIndex(e),o=this._items.length-1;if((s&&0===n||i&&n===o)&&!this._config.wrap)return e;const a=(n+("prev"===t?-1:1))%this._items.length;return-1===a?this._items[this._items.length-1]:this._items[a]}_triggerSlideEvent(t,i){const n=this._getItemIndex(t),o=this._getItemIndex(s.findOne(".active.carousel-item",this._element));return e.trigger(this._element,"slide.bs.carousel",{relatedTarget:t,direction:i,from:o,to:n})}_setActiveIndicatorElement(t){if(this._indicatorsElement){const e=s.find(".active",this._indicatorsElement);for(let t=0;t<e.length;t++)e[t].classList.remove("active");const i=this._indicatorsElement.children[this._getItemIndex(t)];i&&i.classList.add("active")}}_updateInterval(){const t=this._activeElement||s.findOne(".active.carousel-item",this._element);if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);e?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,this._config.interval=e):this._config.interval=this._config.defaultInterval||this._config.interval}_slide(t,i){const o=s.findOne(".active.carousel-item",this._element),a=this._getItemIndex(o),r=i||o&&this._getItemByDirection(t,o),l=this._getItemIndex(r),c=Boolean(this._interval);let h,u,d;if("next"===t?(h="carousel-item-start",u="carousel-item-next",d="left"):(h="carousel-item-end",u="carousel-item-prev",d="right"),r&&r.classList.contains("active"))this._isSliding=!1;else if(!this._triggerSlideEvent(r,d).defaultPrevented&&o&&r){if(this._isSliding=!0,c&&this.pause(),this._setActiveIndicatorElement(r),this._activeElement=r,this._element.classList.contains("slide")){r.classList.add(u),(t=>{t.offsetHeight})(r),o.classList.add(h),r.classList.add(h);const t=(t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:i}=window.getComputedStyle(t);const s=Number.parseFloat(e),n=Number.parseFloat(i);return s||n?(e=e.split(",")[0],i=i.split(",")[0],1e3*(Number.parseFloat(e)+Number.parseFloat(i))):0})(o);e.one(o,"transitionend",()=>{r.classList.remove(h,u),r.classList.add("active"),o.classList.remove("active",u,h),this._isSliding=!1,setTimeout(()=>{e.trigger(this._element,"slid.bs.carousel",{relatedTarget:r,direction:d,from:a,to:l})},0)}),((t,e)=>{let i=!1;const s=e+5;t.addEventListener("transitionend",(function e(){i=!0,t.removeEventListener("transitionend",e)})),setTimeout(()=>{i||n(t)},s)})(o,t)}else o.classList.remove("active"),r.classList.add("active"),this._isSliding=!1,e.trigger(this._element,"slid.bs.carousel",{relatedTarget:r,direction:d,from:a,to:l});c&&this.cycle()}}static carouselInterface(e,s){let n=t.getData(e,a),o={...r,...i.getDataAttributes(e)};"object"==typeof s&&(o={...o,...s});const l="string"==typeof s?s:o.slide;if(n||(n=new h(e,o)),"number"==typeof s)n.to(s);else if("string"==typeof l){if(void 0===n[l])throw new TypeError(`No method named "${l}"`);n[l]()}else o.interval&&o.ride&&(n.pause(),n.cycle())}static jQueryInterface(t){return this.each((function(){h.carouselInterface(this,t)}))}static dataApiClickHandler(e){const s=(t=>{const e=(t=>{let e=t.getAttribute("data-bs-target");if(!e||"#"===e){const i=t.getAttribute("href");e=i&&"#"!==i?i.trim():null}return e})(this);return e?document.querySelector(e):null})();if(!s||!s.classList.contains("carousel"))return;const n={...i.getDataAttributes(s),...i.getDataAttributes(this)},o=this.getAttribute("data-bs-slide-to");o&&(n.interval=!1),h.carouselInterface(s,n),o&&t.getData(s,a).to(o),e.preventDefault()}}var u;e.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",h.dataApiClickHandler),e.on(window,"load.bs.carousel.data-api",()=>{const e=s.find('[data-bs-ride="carousel"]');for(let i=0,s=e.length;i<s;i++)h.carouselInterface(e[i],t.getData(e[i],a))}),u=()=>{const t=(()=>{const{jQuery:t}=window;return t&&!document.body.hasAttribute("data-bs-no-jquery")?t:null})();if(t){const e=t.fn[o];t.fn[o]=h.jQueryInterface,t.fn[o].Constructor=h,t.fn[o].noConflict=()=>(t.fn[o]=e,h.jQueryInterface)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u(),window.Joomla=window.Joomla||{},window.Joomla.Bootstrap={},window.Joomla.Bootstrap.Carousel=h;export default h;
