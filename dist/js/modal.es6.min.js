import t from"./dom/data.js";import e from"./dom/event-handler.js";import i from"./dom/manipulator.js";import s from"./dom/selector-engine.js";const o=t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:i}=window.getComputedStyle(t);const s=Number.parseFloat(e),o=Number.parseFloat(i);return s||o?(e=e.split(",")[0],i=i.split(",")[0],1e3*(Number.parseFloat(e)+Number.parseFloat(i))):0},n=(t,e)=>{let i=!1;const s=e+5;t.addEventListener("transitionend",(function e(){i=!0,t.removeEventListener("transitionend",e)})),setTimeout(()=>{i||(t=>{t.dispatchEvent(new Event("transitionend"))})(t)},s)},d=t=>t.offsetHeight,a="rtl"===document.documentElement.dir,r={backdrop:!0,keyboard:!0,focus:!0},l={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean"};class h extends class{constructor(e){e&&(this._element=e,t.setData(e,this.constructor.DATA_KEY,this))}dispose(){t.removeData(this._element,this.constructor.DATA_KEY),this._element=null}static getInstance(e){return t.getData(e,this.DATA_KEY)}static get VERSION(){return"5.0.0-beta1"}}{constructor(t,e){super(t),this._config=this._getConfig(e),this._dialog=s.findOne(".modal-dialog",t),this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollbarWidth=0}static get Default(){return r}static get DATA_KEY(){return"bs.modal"}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||this._isTransitioning)return;this._element.classList.contains("fade")&&(this._isTransitioning=!0);const i=e.trigger(this._element,"show.bs.modal",{relatedTarget:t});this._isShown||i.defaultPrevented||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),e.on(this._element,"click.dismiss.bs.modal",'[data-bs-dismiss="modal"]',t=>this.hide(t)),e.on(this._dialog,"mousedown.dismiss.bs.modal",()=>{e.one(this._element,"mouseup.dismiss.bs.modal",t=>{t.target===this._element&&(this._ignoreBackdropClick=!0)})}),this._showBackdrop(()=>this._showElement(t)))}hide(t){if(t&&t.preventDefault(),!this._isShown||this._isTransitioning)return;if(e.trigger(this._element,"hide.bs.modal").defaultPrevented)return;this._isShown=!1;const i=this._element.classList.contains("fade");if(i&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),e.off(document,"focusin.bs.modal"),this._element.classList.remove("show"),e.off(this._element,"click.dismiss.bs.modal"),e.off(this._dialog,"mousedown.dismiss.bs.modal"),i){const t=o(this._element);e.one(this._element,"transitionend",t=>this._hideModal(t)),n(this._element,t)}else this._hideModal()}dispose(){[window,this._element,this._dialog].forEach(t=>e.off(t,".bs.modal")),super.dispose(),e.off(document,"focusin.bs.modal"),this._config=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._isTransitioning=null,this._scrollbarWidth=null}handleUpdate(){this._adjustDialog()}_getConfig(t){return((t,e,i)=>{Object.keys(i).forEach(t=>{const s=i[t],o=e[t],n=o&&((d=o)[0]||d).nodeType?"element":(t=>null==t?""+t:{}.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase())(o);var d;if(!new RegExp(s).test(n))throw new Error("modal".toUpperCase()+": "+`Option "${t}" provided type "${n}" `+`but expected type "${s}".`)})})(0,t={...r,...t},l),t}_showElement(t){const i=this._element.classList.contains("fade"),a=s.findOne(".modal-body",this._dialog);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0,a&&(a.scrollTop=0),i&&d(this._element),this._element.classList.add("show"),this._config.focus&&this._enforceFocus();const r=()=>{this._config.focus&&this._element.focus(),this._isTransitioning=!1,e.trigger(this._element,"shown.bs.modal",{relatedTarget:t})};if(i){const t=o(this._dialog);e.one(this._dialog,"transitionend",r),n(this._dialog,t)}else r()}_enforceFocus(){e.off(document,"focusin.bs.modal"),e.on(document,"focusin.bs.modal",t=>{document===t.target||this._element===t.target||this._element.contains(t.target)||this._element.focus()})}_setEscapeEvent(){this._isShown?e.on(this._element,"keydown.dismiss.bs.modal",t=>{this._config.keyboard&&"Escape"===t.key?(t.preventDefault(),this.hide()):this._config.keyboard||"Escape"!==t.key||this._triggerBackdropTransition()}):e.off(this._element,"keydown.dismiss.bs.modal")}_setResizeEvent(){this._isShown?e.on(window,"resize.bs.modal",()=>this._adjustDialog()):e.off(window,"resize.bs.modal")}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._showBackdrop(()=>{document.body.classList.remove("modal-open"),this._resetAdjustments(),this._resetScrollbar(),e.trigger(this._element,"hidden.bs.modal")})}_removeBackdrop(){this._backdrop.parentNode.removeChild(this._backdrop),this._backdrop=null}_showBackdrop(t){const i=this._element.classList.contains("fade")?"fade":"";if(this._isShown&&this._config.backdrop){if(this._backdrop=document.createElement("div"),this._backdrop.className="modal-backdrop",i&&this._backdrop.classList.add(i),document.body.appendChild(this._backdrop),e.on(this._element,"click.dismiss.bs.modal",t=>{this._ignoreBackdropClick?this._ignoreBackdropClick=!1:t.target===t.currentTarget&&("static"===this._config.backdrop?this._triggerBackdropTransition():this.hide())}),i&&d(this._backdrop),this._backdrop.classList.add("show"),!i)return void t();const s=o(this._backdrop);e.one(this._backdrop,"transitionend",t),n(this._backdrop,s)}else if(!this._isShown&&this._backdrop){this._backdrop.classList.remove("show");const i=()=>{this._removeBackdrop(),t()};if(this._element.classList.contains("fade")){const t=o(this._backdrop);e.one(this._backdrop,"transitionend",i),n(this._backdrop,t)}else i()}else t()}_triggerBackdropTransition(){if(e.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented)return;const t=this._element.scrollHeight>document.documentElement.clientHeight;t||(this._element.style.overflowY="hidden"),this._element.classList.add("modal-static");const i=o(this._dialog);e.off(this._element,"transitionend"),e.one(this._element,"transitionend",()=>{this._element.classList.remove("modal-static"),t||(e.one(this._element,"transitionend",()=>{this._element.style.overflowY=""}),n(this._element,i))}),n(this._element,i),this._element.focus()}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight;(!this._isBodyOverflowing&&t&&!a||this._isBodyOverflowing&&!t&&a)&&(this._element.style.paddingLeft=this._scrollbarWidth+"px"),(this._isBodyOverflowing&&!t&&!a||!this._isBodyOverflowing&&t&&a)&&(this._element.style.paddingRight=this._scrollbarWidth+"px")}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}_checkScrollbar(){const t=document.body.getBoundingClientRect();this._isBodyOverflowing=Math.round(t.left+t.right)<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()}_setScrollbar(){if(this._isBodyOverflowing){s.find(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top").forEach(t=>{const e=t.style.paddingRight,s=window.getComputedStyle(t)["padding-right"];i.setDataAttribute(t,"padding-right",e),t.style.paddingRight=Number.parseFloat(s)+this._scrollbarWidth+"px"}),s.find(".sticky-top").forEach(t=>{const e=t.style.marginRight,s=window.getComputedStyle(t)["margin-right"];i.setDataAttribute(t,"margin-right",e),t.style.marginRight=Number.parseFloat(s)-this._scrollbarWidth+"px"});const t=document.body.style.paddingRight,e=window.getComputedStyle(document.body)["padding-right"];i.setDataAttribute(document.body,"padding-right",t),document.body.style.paddingRight=Number.parseFloat(e)+this._scrollbarWidth+"px"}document.body.classList.add("modal-open")}_resetScrollbar(){s.find(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top").forEach(t=>{const e=i.getDataAttribute(t,"padding-right");void 0!==e&&(i.removeDataAttribute(t,"padding-right"),t.style.paddingRight=e)}),s.find(".sticky-top").forEach(t=>{const e=i.getDataAttribute(t,"margin-right");void 0!==e&&(i.removeDataAttribute(t,"margin-right"),t.style.marginRight=e)});const t=i.getDataAttribute(document.body,"padding-right");void 0===t?document.body.style.paddingRight="":(i.removeDataAttribute(document.body,"padding-right"),document.body.style.paddingRight=t)}_getScrollbarWidth(){const t=document.createElement("div");t.className="modal-scrollbar-measure",document.body.appendChild(t);const e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e}static jQueryInterface(e,s){return this.each((function(){let o=t.getData(this,"bs.modal");const n={...r,...i.getDataAttributes(this),..."object"==typeof e&&e?e:{}};if(o||(o=new h(this,n)),"string"==typeof e){if(void 0===o[e])throw new TypeError(`No method named "${e}"`);o[e](s)}}))}}var c;e.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',(function(s){const o=(t=>{const e=(t=>{let e=t.getAttribute("data-bs-target");if(!e||"#"===e){const i=t.getAttribute("href");e=i&&"#"!==i?i.trim():null}return e})(this);return e?document.querySelector(e):null})();"A"!==this.tagName&&"AREA"!==this.tagName||s.preventDefault(),e.one(o,"show.bs.modal",t=>{t.defaultPrevented||e.one(o,"hidden.bs.modal",()=>{(t=>{if(!t)return!1;if(t.style&&t.parentNode&&t.parentNode.style){const e=getComputedStyle(t),i=getComputedStyle(t.parentNode);return"none"!==e.display&&"none"!==i.display&&"hidden"!==e.visibility}return!1})(this)&&this.focus()})});let n=t.getData(o,"bs.modal");if(!n){const t={...i.getDataAttributes(o),...i.getDataAttributes(this)};n=new h(o,t)}n.show(this)})),c=()=>{const t=(()=>{const{jQuery:t}=window;return t&&!document.body.hasAttribute("data-bs-no-jquery")?t:null})();if(t){const e=t.fn.modal;t.fn.modal=h.jQueryInterface,t.fn.modal.Constructor=h,t.fn.modal.noConflict=()=>(t.fn.modal=e,h.jQueryInterface)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c(),window.Joomla=window.Joomla||{},window.Joomla.Bootstrap={},window.Joomla.Bootstrap.Modal=h;export default h;
